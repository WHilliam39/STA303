---
title: "Gender Parity Report"
subtitle: "Analysis of fairness in hring, wages and promotion"
author: "Report prepared for Black Saber Software by White Shield Analytics"
date: 2021-04-21
lang: "en"
output:
  pdf_document:
    template: report.tex
    toc: true
    toc_depth: 2
titlepage: true
titlepage-color: "20283E"
titlepage-text-color: "FFFFFF"
titlepage-rule-color: "FFFFFF"
titlepage-rule-height: 2
---

```{r message=FALSE, include=FALSE}
library(tidyverse)
library(lme4)
library(ggplot2)
library(DataExplorer)
library(Hmisc)
library(nlme)
library(ggbeeswarm)
library(lmtest)
# this should supress all code and messages
knitr::opts_chunk$set(include=FALSE)
```

\newpage
# Executive summary

_Guidelines for the executive summary:_

* _No more than two pages_
* _Language is appropriate for a non-technical audience_
* _Bullet points are used where appropriate_
*	_A small number of key visualizations and/or tables are included_
*	_All three research questions are addressed_

(add more)This study assesses ethnicity/race fairness in hiring, promotion, and salary processes based on the existing employees and hiring data from Black Saber Software.   

We estimate that, 

The results of the study are summarized below.  

* _1_
* _1_
* _1_
*	_1_
*	_1_
  
The key results of the study are summarized in the following tables.  

\newpage
# Technical report

## Introduction

We, White Shield Analytics, accepted a commission from Black Saber Software to conduct an analysis to tell whether there is bias in the process of hiring, promotion and salary. For the analysis of hiring process, Black Saber Software provide data of hiring a new AI recruitment pipeline manager. For promotion and salary, the data of current employee were provided.  
  
### Research questions:
In this report, we will use these provided data and conduct statistical analysis to address the following research questions:

- Is the process of hiring fair in genders and based on the skills and abilities of candidates?
- Is there a gender wage gap in Black Saber?
- Is there a gender promotion gap in Black Saber? 

## 1. Is the process of hiring fair in genders and based on the skills and abilities of candidates?

```{r include=FALSE}
#extract hiring data
final_hiring<-read_csv("data/final-hires-newgrad_2020.csv")
phase1<-read_csv("data/phase1-new-grad-applicants-2020.csv")
phase2<-read_csv("data/phase2-new-grad-applicants-2020.csv")
phase3<-read_csv("data/phase3-new-grad-applicants-2020.csv")
```

```{r include=FALSE}
#get final hiring all detailed info
combine_phase2_phase3<-inner_join(phase2,phase3,by="applicant_id")
final_hiring<-inner_join(combine_phase2_phase3,final_hiring,by="applicant_id")
#get full table of all applicants
combine_phase1_phase2<-left_join(phase1,phase2,keep=FALSE)
all_phase<-left_join(combine_phase1_phase2,phase3,keep=FALSE)
```

```{r include=FALSE}
#get hiring status
all_phase$status<-ifelse(all_phase$applicant_id %in% final_hiring$applicant_id,"Hired",
                  ifelse(all_phase$applicant_id %in% phase1$applicant_id,"Rejected"))
all_phase<-as.data.frame(unclass(all_phase))
all_phase$applicant_id<-as.character(all_phase$applicant_id)
```
The data was provided by Black Saber, which is about hiring an AI recruitment pipeline manager. There were totally 613 candidates and finally 10 of them were hired. For each candidate there is a application id as their unique identifier. There were three phases of the hiring process. For the first phase, the department applied for, whether cover letter or CV was provided, GPA, gender, extracurriculars, and internship experience was collected. After phase 1, 313 candidates were filtered. During phase 2, technical skills, writing skills, leadership presence, and speaking skills of each candidates were collected as a scour out of 100. After the review of phase 2, only 22 candidates were left and two interviews were taken for each candidates with a rating out of 100 during phase 3. Finally 10 candidates were hired.

For each phase, Black Saber provided a data set in csv file with a list of application id of hired candidates. To analyze the whole process of hiring, we join all these 4 tables together so that each row of the data set represents the whole condition of a candidate. If some candidate did not get into phase 2 or phase 3, the corresponding data column will be \texttt{NA}. As for our question, we are interested in the gender parity in the hiring process. First we can look at the ratio of male, female, and prefer not to say within both hired and rejected candidates.  

```{r}
#gender distribution on status
all_phase%>%ggplot(aes(x=status,fill=gender))+geom_bar(position = "fill")+theme_minimal()+
  labs(title="Gender distribution in hiring status, Black Saber Software",
      x="Status",
      y="Percentage",
      caption=str_c("Created by: White Sheild Analytics\n","Source: Black Saber Software\n"))+
  scale_fill_brewer(palette = "Paired")
ggsave("images/hiring_status.png",width = 7, height = 4)
```
![Gender Ratio in Hired/Rejected Candidates](images/hiring_status.png)

From \textit{Figure 4}, we can see that in the hired candidates female only account for around 20% and 80% of the hired candidates are male. For the rejected candidates, the ratio of female and male is almost 1 to 1 with only a few candidates prefer not to say. It seems that Black Saber is hiring more male than female, but there could be the case that these hired males are better in skills and abilities. To check this, we can look at the ratings and scores in phase 3 and phase 2, and the GPA in phase 1.  

```{r}
#gender distribution on interview score
all_phase%>%ggplot(aes(x=interviewer_rating_1,y=interviewer_rating_2, color=gender))+geom_point(size=2)+theme_minimal()+
  labs(title="Interview score with race, Black Saber Software",
      x="Interview 1 rating",
      y="Interview 2 rating",
      caption=str_c("Created by: White Sheild Analytics\n","Source: Black Saber Software\n"))+
  scale_color_brewer(palette = "Paired")
ggsave("images/hiring_interview.png",width = 7, height = 4)
```
![Interview Ratings from Phase 3](images/hiring_interview.png)

According to \textit{Figure 5}, although there are fewer females in phase 3 but their rating are greater than or equal to most males. From this figure we could not get helpful information because the number of females is too small and there could be possible bias in rating when the interviews were taken.   

```{r}
#gender distribution on GPA
all_phase %>% ggplot(aes(x=status,y=gpa, color=gender)) + 
  geom_quasirandom(size=1) + coord_flip() + 
  geom_hline(yintercept=3, linetype="dashed",color = "orange") + 
  theme_minimal() + ylim(1,4) + labs(title="Applicant GPA with hiring status, Black Saber Software",
      x="Hiring Status",
      y="GPA",
      caption=str_c("Created by: White Sheild Analytics\n","Source: Black Saber Software\n"))+
  scale_color_brewer(palette = "Paired")
ggsave("images/hiring_gpa.png",width = 7, height = 4)
```



\begin{figure}
\centering
  \includegraphics[width=0.5\textwidth]{./images/hiring_gpa.png}
  \caption{GPA Distribution}
\end{figure}


From \textit{Figure 6}, all candidates that were finally hired have a GPA over 3.0. And males' GPA seems higher than females'. This seems that the hiring process is based on candidates' ability.

```{r}
#gender distribution on technical skill score
all_phase%>%ggplot(aes(x=technical_skills,color=gender))+geom_freqpoly(binwidth=10,size=1.5)+theme_minimal()+labs(title="Technical skill score distribution with race, Black Saber Software",
      x="Number of applicants",
      y="Score",
      caption=str_c("Created by: White Sheild Analytics\n","Source: Black Saber Software\n"))+
  scale_color_brewer(palette = "Paired")
ggsave("images/hiring_techskill.png",width = 7, height = 4)
```
![Technical Skills Distribution](images/hiring_techskill.png)
```{r}
#gender distribution on writing skill score
all_phase%>%ggplot(aes(x=writing_skills,fill=gender))+geom_histogram(binwidth=3)+theme_minimal()+
  labs(title="Writing skill score distribution with race, Black Saber Software",
      x="Number of applicants",
      y="Score",
      caption=str_c("Created by: White Sheild Analytics\n","Source: Black Saber Software\n"))+
  scale_fill_brewer(palette = "Paired")
ggsave("images/hiring_writingskill.png",width = 7, height = 4)
```
![Writing Skills Distribution](images/hiring_writingskill.png)
```{r}
#gender distribution on speaking skill
all_phase%>%ggplot(aes(x=speaking_skills,fill=gender))+geom_bar(position = "fill")+xlab("Socre")+ylab("Percentage")+theme_minimal()+coord_flip()+
  labs(title="Speaking skill score distribution with race, Black Saber Software",
      x="Score",
      y="Percentage",
      caption=str_c("Created by: White Sheild Analytics\n","Source: Black Saber Software\n"))+
  scale_fill_brewer(palette = "Paired")
ggsave("images/hiring_speakingskill.png",width = 7, height = 4)
```
![Speaking Skills DIstribution](images/hiring_speakingskill.png)
```{r}
#gender distribution on leadership presence
all_phase%>%ggplot(aes(x=leadership_presence,fill=gender))+geom_bar(position = "fill")+xlab("Socre")+ylab("Percentage")+theme_minimal()+coord_flip()+
  labs(title="Leadership presence score distribution with race, Black Saber Software",
      x="Score",
      y="Percentage",
      caption=str_c("Created by: White Sheild Analytics\n","Source: Black Saber Software\n"))+
  scale_fill_brewer(palette = "Paired")
ggsave("images/hiring_leadership.png",width = 7, height = 4)
```
![Leadership Distribution](images/hiring_leadership.png)  
  
\textit{Figure 7} to \textit{Figure 10} visualize the abilities of candidates in different genders, which involved technical skills, writing skills, speaking skills, and leadership.

- From \textit{Figure 7}, we can see that for all genders the plot is approximately normally distributed, which makes sense because most of the people are within the median level and those whole are really good at or bad at something are rare. In this case, the gender ratio in next phase should be around 1 to 1. So from this figure there could be some unfair in this process.  
- From \textit{Figure 8}, we can see that although it seems approximately normally distributed for all genders but scores of males are higher then females. Therefore, it makes sense that more males passed this phase.  
- From \textit{Figure 9} and \textit{Figure 10}, there are more males with higher ratings. This also supports the finding from the previous one. 

From all these figures we could only get an approximate result. To be rigorous and precise, we have to use some statistical models to help the analysis.  
```{r include=FALSE}
#create binary variable for each of the phase
phase1$result<-ifelse(phase1$applicant_id%in%phase2$applicant_id,'Proceed','NO')
phase2$result<-ifelse(phase2$applicant_id%in%phase3$applicant_id,'Proceed','NO')
combine_phase2_phase3$result<-ifelse(combine_phase2_phase3$applicant_id%in%final_hiring$applicant_id,'Proceed','NO')
all_phase$result<-ifelse(all_phase$applicant_id%in%final_hiring$applicant_id,'Hired','NO')
```

```{r include=FALSE}
#fit mixed logistic regression model
phase1<-as.data.frame(unclass(phase1))
# logistic model
model_phase1<-glm(as.factor(result)~cover_letter+cv+gpa+gender+extracurriculars+work_experience
                ,data = phase1,family = binomial)
summary(model_phase1)
round(confint(model_phase1), 4)
```

```{r include=FALSE}
#fit mixed logistic regression model
phase2<-as.data.frame(unclass(phase2))
# logistic model
model_phase2<-glm(as.factor(result)~gpa+gender+technical_skills+writing_skills+leadership_presence+speaking_skills,data = phase2,family = binomial)
summary(model_phase2)
round(confint(model_phase2), 4)
```

```{r include=FALSE}
#fit mixed logistic regression model
combine_phase2_phase3<-as.data.frame(unclass(combine_phase2_phase3))
# average of interview 1 and 2
combine_phase2_phase3<-combine_phase2_phase3%>%mutate(avg_rating=(interviewer_rating_1+interviewer_rating_2)/2)
# logistic model
model_phase3<-glm(as.factor(result)~ gender + avg_rating, data = combine_phase2_phase3, family = binomial)
summary(model_phase3)
round(confint(model_phase3), 4)
```
We will use logistic model \texttt{glm} to train our data since the response variable is the outcome of each phase, which is binary. 

For phase 1 we fit model which takes the result of phase 1 as response variable and other data as the dependent variable. From \texttt{R} we could get \textit{Table 1}.
\begin{table}
\centering
\caption{Model paratemters for phase 1}
\begin{tabular}{|c|c|c|c|}
  \hline
  Parameter  & Estimation & p-value & 95\%CI \\
  \hline
  Intercept & -157.8582 & 0.9774 & [-2326.3357, 19.5074]\\
  \hline
  cover letter & 61.3650 & 0.9827 & [-1694.5016, 1260.0174] \\
  \hline
  cv & 49.7887 &  0.9917 & [-115.5787, 1848.9455]\\
  \hline
  gpa & 12.6333 & 0.0001 & [7.3521, 20.6550] \\
  \hline
  genderPrefer not to say  & 0.6266 &  0.9612 & [-8.4199, 10.4821] \\
  \hline
  genderWoman & 0.9061 & 0.3531 & [-0.9210, 3.0170] \\
  \hline
  extracurriculars & 9.9649 & 5.47e-05 & [6.0431, 16.0484]\\
  \hline
  work experience & 11.5861 & 3.62e-05 & [7.1330, 18.3431]\\
  \hline
\end{tabular}
\end{table}
According to \textit{Table 1}, we can see that only p-value of GPA, extra curriculars experience, and work experience is smaller than the significance level($\alpha=0.05$). Which means only these parameters are significant in this model. And from the 95% confidence interval we can see only confidence intervals for these variables do not include zero, which supports the results from p-value. From this model we can conclude that phase 1 is fair in gender and was based on the talent and ability of candidates.

We did the similar model fitting for phase 2 data and phase 3 data.

For phase two we have parameters in \textit{Table 2}.Like the first model,  we use the result of phase 2 as the response varibale and fitted a logistic model.
\begin{table}
\centering
\caption{Model paratemters for phase 2}
\begin{tabular}{|c|c|c|c|}
  \hline
  Parameter  & Estimation & p-value & 95\%CI \\
  \hline
  Intercept & -19.7717 & 2.88e-07 & [-28.4751, -13.1651]\\
  \hline
  gpa & -0.8578 & 0.2032 & [-2.2542, 0.4401] \\
  \hline
  genderPrefer not to say  & -16.4816 &  0.9936 & [NA, 246.3442] \\
  \hline
  genderWoman & 0.9061 & 0.3531 & [-2.0804, 0.8164] \\
  \hline
  technical skills & 0.0921 & 0.0001 & [0.0516, 0.1462]\\
  \hline
  writing skills & 0.1024 & 8.81e-05 & [0.0564, 0.1601]\\
  \hline
  leadership presence & 0.9594 & 8.23e-06 & [0.5881, 1.4448]\\
  \hline
  speaking skills & 0.7511 & 1.94e-05 & [0.4388, 1.1386]\\
  \hline
\end{tabular}
\end{table}

From \textit{Table 2} we can see that p-values of the four skills are smaller than 0.05, so these parameters are significant. And their 95% CI does not contain 0, which supports the findings from p-value. Also, GPA and gender variables are not significant in this model. This makes sense because these candidates have already been selected based on their GPA in phase 1. Therefore, in this phase the selection of candidates is based on their skills in four aspects: technique, writing, leadership and speaking. And there is no bias on gender in this phase.

Last but not the least, we used the result of phase 3 as the response variable and the average rating of two interviews as dependent variables to fit the third model. The parameters are in \textit{Table 3}.

\begin{table}
\centering
\caption{Model paratemters for phase 3}
\begin{tabular}{|c|c|c|c|}
  \hline
  Parameter  & Estimation & p-value & 95\%CI \\
  \hline
  Intercept & -5839.213 & 0.998 & [-89033.5566, 77355.14]\\
  \hline
  genderWoman & -48.19 & 1.000 & [-97841.2789, 111787.35] \\
  \hline
  average interview rating  & 76.71 &  0.998 & [-193.5876, 7124.00] \\
  \hline
\end{tabular}
\end{table}
From \textit{Table 3}, we can see that all p-values are greater than 0.05 and all confidence intervals are very wide and include zero. So in this phase we can conclude that there is no gender bias in the decision of hiring.

In summary, although it seems that more males are finally hired, all these three phases of hiring are fair in gender and the talent, skills and abilities of candidates are the criterion of hiring.

## 2. Is there a gender wage gap in Black Saber?

The second research question in our report is to analyze the potential impact of gender in salaries and how Black Saber is doing around pay equity based on the productivity and talent of their employees. 

The data we used are from the current employees in Black Saber Software which has a total size of 6906 records that may contain different records based on different time quarters from the same employee. In the data frame, we have inforamtion such as the unique employee’s ID (employee_id), the gender of employee (gender), the team they belong to (team), the financial quarter of the record (financial_q), the employee's level of seniority (role_ seniority), the evaluation of employee’s leadership (leadership_for_level), measure the  employee’s productivity relative to job functions (productivity), and salary for each quarter (salary).


```{r, echo=FALSE, results='hide', fig.show='hide'}
# data wrangling for research questions 2 and 3

# read in the data
black_saber_current_employees <- read_csv("data/black-saber-current-employees.csv")

# exploratory data analysis on current employees:
current_employee <- black_saber_current_employees
summary(current_employee)

# change variable data types:
current_employee$employee_id <- as.character(current_employee$employee_id)
current_employee$gender <- as.factor(current_employee$gender)
current_employee$team <- as.factor(current_employee$team)
current_employee$role_seniority <- as.factor(current_employee$role_seniority)
current_employee$leadership_for_level <- as.factor(current_employee$leadership_for_level)

current_employee$salary <- gsub("\\$", "", current_employee$salary)
current_employee$salary <- gsub("\\,", "", current_employee$salary)
current_employee$salary <- as.numeric(current_employee$salary)

# histogram about current_employee data:
current_employee %>% ggplot(aes(x=productivity, fill=gender)) + geom_histogram(binwidth=3) + theme_minimal() +     
  labs(title="Frequencies by Productivity, Black Saber Software",
      x="Frequencies",
      y="Value of Productivity",
      caption=str_c("Created by: White Sheild Analytics\n","Source: Black Saber Software\n")) +
  scale_fill_brewer(palette = "Paired")
ggsave("images/productivity_histo.png",width = 7, height = 4)

current_employee %>% ggplot(aes(x=salary, fill=gender)) + geom_histogram() + theme_minimal() + 
  labs(title="Frequencies by Salary, Black Saber Software",
      x="Frequencies",
      y="Annual Salary in Dollars",
      caption=str_c("Created by: White Sheild Analytics\n","Source: Black Saber Software\n")) +
  scale_fill_brewer(palette = "Paired")
ggsave("images/salary_histo.png",width = 7, height = 4)

# correlation between productivity and salary:
cor(current_employee$productivity,current_employee$salary)

# exploratory data analysis for gender wage gap:
current_employee %>% ggplot(aes(x=productivity, y=gender)) + geom_boxplot() + theme_minimal() + labs(title="Box Plot of Productivity Grouped by Gender, Black Saber Software",
      x="Productivity",
      y="Gender",
      caption=str_c("Created by: White Sheild Analytics\n","Source: Black Saber Software\n"))+
  scale_color_brewer(palette = "Paired")
ggsave("images/productivity_box.png",width = 7, height = 4)

current_employee %>% ggplot(aes(x=salary, y=gender)) + geom_boxplot() + theme_minimal() + labs(title="Box Plot of Salaries Grouped by Gender, Black Saber Software",
      x="Salary",
      y="Gender",
      caption=str_c("Created by: White Sheild Analytics\n","Source: Black Saber Software\n"))+
  scale_color_brewer(palette = "Paired")
ggsave("images/salary_box.png",width = 7, height = 4)

```
![Histgram of Frequencies by Productivity.](images/productivity_histo.png)

![Histgram of Frequencies by Salary.](images/salary_histo.png)

To make the raw data more appropriate and useful for our analyzing goal, we change the format of few variables like the team, gender, employee’s ID, level of seniority, and evaluation of leadership to a proper format for later use. Also we reformat the value of salary for each record by deleting the dollar sign '$' and remove any empty space and transform all the values into numeric forms.


Recall the research question that we want to analyze the fairness of the salary process, so we created a basic histogram \textit{Figure ?} to have a look at the frequencies of records on different productivity values and salary numbers. The productivity is close to a symmetric bell curve shape which may imply a normal distribution of productivity of employees. But for the salary, the histogram \textit{Figure ?} indicates an accumulation of records around 40,000 dollars per year and there are two small groups of people with higher than usual salaries in the range of 120,000 dollars to 160,000 dollars per year. These extreme high annual pays may come from those employees as executives and senior managers. So in this stage we can raise a concern about the unbalanced relation between productivity and salary. Then we calculate the correlation between the salary and productivity since we want to see how strong the salary and productivity are related in this firm. The value we get is - 0.0356, so productivity is negatively correlated to the salary in a weak correlation, which means that when the value of productivity rises but the salary decreases. 


```{r, echo=FALSE, results='hide', fig.show='hide'}
# exploratory data analysis for gender wage gap:

# boxplot on productivity grouped by gender:
plot_boxplot(current_employee, title = "Boxplot of productivity and salary grouped by gender",by = "gender", geom_boxplot_args = list("outlier.color" = "grey"))
ggsave("images/productivity_salary_box.png",width = 7, height = 4)

# scatterplot on the rpoductivity by salary grouped by gender:
ggplot(data = current_employee, aes(x = productivity,y=salary, colour = gender)) +
  geom_point(size=0.8)+theme_minimal()+
  labs(title="Productivity by Salary, Black Saber Software",
      x="Productivity",
      y="Salary",
      caption=str_c("Created by: White Sheild Analytics\n","Source: Black Saber Software\n"))+
  scale_color_brewer(palette = "Paired")
ggsave("images/productivity_salary_ggplot.png",width = 7, height = 4)

```

![Box plot of productivity grouped by gender.](images/productivity_box.png)

![Box plot of salary grouped by gender.](images/productivity_salary_box.png)

![Scatter plot of productivity by salary.](images/productivity_salary_ggplot.png)

After having a look at the big picture, we want to focus on the gender parity in salary processing. In the \textit{Figure ?} and \textit{Figure ?} which are box plots of productivity and salary grouped into woman, Prefer not to say and the man. The man has a comparably lower productivity median but higher salary median, and salary from three groups are positively skewed which also indicates a group of records with high salaries. This is caused by the minimum wage by law and also the natural construction of an organization and company. In the \textit{Figure ?} which is a scatter plot of productivity by salary, we still can see there are three major stages that salaries accumulated, the number of women and men seems proportional to the ratio of gender in the company, but also we can see the man occupied the highest salaries on every stage of salaries with a wide range of productivity value.

```{r, echo=FALSE, results='hide', fig.show='hide'}
# fit models for research question 2 

# first linear regression model1 with fixed effects
salary_simple_lm = lm(salary~gender + team + role_seniority + leadership_for_level + productivity, data=current_employee)
summary(salary_simple_lm)
confint(salary_simple_lm)
```
To investigate the impact of gender on salary, we estimate a **Linear Regression** model 1 which includes the gender of the employee, the team they belong to, the employee's level of seniority, the evaluation of employee’s leadership ,employee’s productivity as fixed effects. Because we expect that the above elements will have an effect on the salary in a standard linear regression, and we would like to know how they affect the salary. 

```{r}
# second linear mixed effect model2 with random effect of distinct team:
salary_mixed_1 <- lmer(salary~gender + gender + role_seniority  + leadership_for_level + productivity + (1|team), data=current_employee)
summary(salary_mixed_1)
#confint(salary_mixed_1)

```
The second model 2 we use **Linear Mixed Effect Model ** which includes the team as a random effect on the salary to improve the previous model 1. This is because the team is categorized and the beneficial results or leadership of the manager in different teams may have varied effects on salary, and we would like to know how much variation is contributed to this when we estimate the salary. Fixed effects in the model included gender of the employee, the employee's level of seniority, the evaluation of employee’s leadership ,employee’s productivity as fixed effects.

```{r, echo=FALSE, results='hide'}
options(scipen=999)
# third linear fixed effect model3 with random effect with individual employee and distinct team:
salary_mixed_2 <- lmer(salary~gender + gender + role_seniority + leadership_for_level + productivity + (1|team) + (1|employee_id), data=current_employee )

summary(salary_mixed_2)
confint(salary_mixed_2)
```
The third model 3 we use **Linear Mixed Effect Model ** which includes the individual employee as a random effect on the salary to improve the previous model 2. This is because one employee might have many records in the data set and for each of them may have ability and talent in different levels, and we would like to know how much variation is contributed to this when we estimate the salary. Fixed effects in the model is the same as above included gender of the employee, the employee's level of seniority, the evaluation of employee’s leadership ,employee’s productivity as fixed effects.

```{r, echo=FALSE, results='hide'}
lrtest(salary_simple_lm, salary_mixed_1)
lrtest(salary_mixed_1, salary_mixed_2)
```
We conduct a likelihood ratio tests to find a final model, and we can see from two test (between model 1 and model 2 and between model 2 and model 3 )the p-value is quite low and same as 1.27e-09. This tells us that the most complex model 3 with the team and individual employee as random effects is significantly more accurate than rest two models, so we will move forward with the third linear mixed effect model 3 for further interpretations.

\begin{table}
\centering
\caption{Model Paratemters From Model 3}
\begin{tabular}{|c|c|c|}
  \hline
  Parameter  & Estimation & 95\%Confidence Interval \\
  \hline
  intercept & 122751.1011 & [121574.2580, 123902.9252]\\
  \hline
  gender prefer not to say & -1087.1097 & [-3101.6608, 945.5988] \\
  \hline
  gender woman & -2259.1905 & [-2802.9678, -1722.0322]\\
  \hline
  level exceeds expectations & -4.3367 & [-142.8119, 134.1472] \\
  \hline
  level needs improvement & 245.2283 &  [62.0527, 428.4788]\\
  \hline
  productivity  & -0.8518 & [-3.2015, 1.4963] \\
  \hline
\end{tabular}
\end{table}

In the \textit{Table ?} of the third model 3, we see some import values from model 3. In this table, we found a highly significant negative effect of gender as women indicated by an 95\% confidence from -2802.9678 to -1722.0322 interval which doesn't contain 0. The value is -2259.1905 which means women may earn 1787 dollars less annually than men under the same conditions. Furthermore, we see that there is a weak tendency for hard working employees are more likely to have lower pays, since the interval is from -3.2015 to 1.4963 and covers 0, so the evidence is not strong enough to conclude. Also there is a interesting thing to notice that the employees who needs improvements at their levels actually has a positive affect with 245.2283 dollars on their salary under this condition.

In summary, after analyzing the records of current employees and fitting an appropriate linear mixed effect model to help us make interpretations, there is a gender wage gap in Black Saber based on current situation and our model. What's more, there is a tendency that the factor of needing improvements actually affect salaries positively. 


## 3. Is there a gender promotion gap in Black Saber?

The third research question in our project is to identify the impact of gender during the promotion process. We use the same data set that used in the second research question that talks about whether there exist a gender salary gap in Black Saber Software.

The first step is to clean and organize this data set, we created a new variable to measure the number of promotion in his/her current career. We use the total level of senior, which is nine, to minus the number of roles that they have experienced. Then we group the productivity by employee_id and calculate the annual salary for each employee. Under each quarter, the firm would measure the performance of each employee to determine their leadership whether satisfy the role requirements, with appropriate, exceed and need improvement categories. Hence, we calculate the appearance of leadership performance from each employee under the three levels. After we finish the organization step, we have built a new data set (new_data) to analysis the impact of gender in promotion process. We choose to use the **Linear Mixed Effects Model**, because the data can separate by different groups that all observations are not completely independent to each other, such as employees can group by team, and also can group by level of senior. Therefore, this model can illustrates the random effect and fixed effect to the response variable, and we would use the likelihood test to determine which model has better performance on the data set.

```{r,echo=FALSE, results='hide', fig.show='hide'}
#create subset for # of promotion:
num_promoted <- current_employee %>% select(employee_id,role_seniority)
wip1 <- num_promoted %>% 
  group_by(employee_id) %>% count(role_seniority) %>%
  pivot_wider(names_from = role_seniority, values_from = n) 
wip1$na_count <- apply(wip1, 1, function(x) sum(is.na(x)))
wip1$num_promoted <- 9 - wip1$na_count
promoted <- wip1[,c(1,12)] 

#average productivity for every employee:
avg_prod <- current_employee %>% group_by(employee_id) %>% summarise(mean(productivity))
avg_prod

#calculate salary increase for every employee:
wip2<- current_employee %>% group_by(employee_id) %>% summarise(max(salary))
wip3 <- current_employee %>% group_by(employee_id) %>% summarise(min(salary))
salary_inc <- inner_join(wip2,wip3,mby="employee_id")
salary_inc$raise <- salary_inc$`max(salary)`-salary_inc$`min(salary)`
```

```{r,echo=FALSE, results='hide', fig.show='hide'}
#Re-join all new features with unique employee ID: 
all_employee <- inner_join(avg_prod,promoted,by="employee_id")
all_employee <- inner_join(all_employee,salary_inc,by="employee_id")
all_employee <- all_employee[,c(1,2,3,6)]
all_employee$salary_raise <- all_employee$raise
all_employee$avg_productivity <- all_employee$`mean(productivity)`
all_employee <- all_employee[,c(1,3,5,6)]

other_subset <- current_employee[,c(1:3, 6)]
leadership <- other_subset %>% 
  group_by(employee_id) %>% count(leadership_for_level) %>%
  pivot_wider(names_from = leadership_for_level, values_from = n) 
leadership[is.na(leadership)] <- 0

other_subset <- other_subset[,c(1:3)]
other_subset <- distinct(other_subset)

new_data <- inner_join(all_employee, leadership, by="employee_id")
new_data <- inner_join(new_data, other_subset, by="employee_id")
```

```{r,echo=FALSE, results='hide', fig.show='hide'}
#change variable data types:
new_data$gender <- as.factor(new_data$gender)
new_data$team <- as.factor(new_data$team)

new_data$leadership_appropriate <- new_data$`Appropriate for level`
new_data$leadership_needsimprov <- new_data$`Needs improvement`
new_data$leadership_exceeds <- new_data$`Exceeds expectations`
new_data <- new_data[,-c(5:7)]

str(new_data)
```

```{r,echo=FALSE, results='hide', fig.show='hide'}
#EDA:
# scatterplot on the productivity by number of promoted grouped by gender:
ggplot(data = new_data, aes(x = avg_productivity,y=num_promoted, colour = gender)) +
  geom_quasirandom(size=1,groupOnX = FALSE)+
  theme_minimal()+
  labs(title = "Gender distribution in productivity and number of promoted",
       caption=str_c("Created by: White Sheild Analytics\n","Source: Black Saber Software\n"),x="Average productivity",y="Numbers of promotion")+
  scale_color_brewer(palette = "Paired")
ggsave("images/promotion_productivity.png",width = 7, height = 4)
```
![Gender Distribution on productivity by number of promotion.](images/promotion_productivity.png)


```{r,echo=FALSE, results='hide', fig.show='hide'}
#EDA:
#role seniority on gender:
ggplot(current_employee, aes(role_seniority, ..count..)) + geom_bar(aes(fill = gender), position = "fill")+
  theme_minimal()+
  labs(title = "Gender distribution in role senority",
       caption=str_c("Created by: White Sheild Analytics\n","Source: Black Saber Software\n"),y="Percentage",x="Role Seniority")+
  scale_fill_brewer(palette = "Paired")
ggsave("images/gender_role_senority.png",width = 7, height = 4)
```
![Gender Ratio in Role Senority.](images/gender_role_senority.png)

- From \textit{Figure ?}, we can see that the females group concentrates on one or two times of promotion, though she has relativly larger productivity than the males. The distribution of the males is more concentrated in the center of productivity and a larger number of promotion. 
- From\textit{Figure ?}, it illusrates that the males group has more chance to promoted than females because the men has occupied a larger percentage when the position increases.

```{r,echo=FALSE, results='hide', fig.show='hide'}
#scatterplot on the leadership exceed expectation and number of promoted
ggplot(data = new_data, aes(x = leadership_exceeds,y=num_promoted,colour = gender))+
  geom_point(size=3)+
  theme_minimal()+
  labs(title = "Gender distribution in leadership exceed expectation and number of promoted",
       caption=str_c("Created by: White Sheild Analytics\n","Source: Black Saber Software\n"),y="Leadership exceeds", x="Numbers of promotion")+
  scale_color_brewer(palette = "Paired")
ggsave("images/promotion_exceeds_leadship.png",width = 7, height = 4)
```
![Gender Distribution on exceeded leadership by the number of promotion.](images/promotion_exceeds_leadship.png)

```{r,echo=FALSE, results='hide', fig.show='hide'}
#leadership for level on gender:
ggplot(current_employee, aes(leadership_for_level, ..count..)) + 
  geom_bar(aes(fill = gender), position = "fill")+
  theme_minimal()+
  labs(title = "Gender distribution in leadership level",
       caption=str_c("Created by: White Sheild Analytics\n","Source: Black Saber Software\n"),x="Leadership levels",y="Percentage")+
  scale_fill_brewer(palette = "Paired")
ggsave("images/gender_leadership.png",width = 7, height = 4)
```
![Gender Ratio in Leadership Level.](images/gender_leadership.png)

-From \textit{Figure ?}, we can see that the majority of employees' leadership exceed their expectation are males.

-From \textit{Figure ?}, we can see that the gender in "leadership exceed expectation" category is only men, and the female has occupied above 90% in "leadership needs to improve" category.

```{r,echo=FALSE, results='hide', fig.show='hide'}
#fixed effects & random effects:
salary_role_seniority<- lmer(salary ~gender+team+role_seniority+leadership_for_level+productivity+(1|role_seniority),data=current_employee) #group by role seniority
summary(salary_role_seniority)
confint(salary_role_seniority)
```
\begin{table}
\centering
\caption{Model parameter of role seniority}
\begin{tabular}{|c|c|c|}
  \hline
  Parameter & Estimation & 95\%CI\\
  \hline
  Intercept & 120708.379 & [ 120177.2198,121239.5377]\\
  \hline
  genderPrefer not to say &-1285.765 &[-1906.3641,  -665.1654]\\
  \hline
  genderWomen &-1785.606  &[ -1959.2665,-1611.9447]\\
  \hline
  teamData & 3796.712 & [3505.4989, 4087.9253]\\
  \hline
  role\_seniorityEntry-level & -91071.229 & [-91540.3688, -90602.0901]\\
  \hline
\end{tabular}
\end{table}

Under this **linear mixed effects model**, it grouped by the position of senior of each employees that is the random effect of this model. There are much difference in salary between the senior groups different. It shows the correlation between each variable, and the summary table illustrates the estimate and 95% confidence interval of each variable. From the \textit{Table ?} on above, the female group has a negative relationship with the salary in each role seniority group, it represents the females earned relative less salary than males in each senior position. Moreover, the team they work with and the senior level have significant effect in this salary model due to their 95% confidence interval does not contain zero. It means the changing in team and role_seniority variables would provide an obvious difference in their salary that is suitable with our common sense.

```{r,echo=FALSE, results='hide', fig.show='hide'}
#Fit model:
#fixed effects & random effects:
#number of promotions as outcome variable:
model_num_promote <- lmer(num_promoted ~
                           gender+team+leadership_appropriate+(1|leadership_appropriate),
                         data=new_data)
summary(model_num_promote)
confint(model_num_promote)
```
\begin{table}
\centering
\caption{Model parameters from number of promotion}
\begin{tabular}{|c|c|c|}
  \hline
  Parameter & Estimation & 95\%CI\\
  \hline
  Intercept &  0.9337  & [ 0.7202,1.1520]\\
  \hline
  genderWomen & -0.2943  &[ -0.4267, -0.1604]\\
  \hline
  leadership\_appropriate & 0.1157 &[0.1033,0.1276]\\
  \hline
\end{tabular}
\end{table}
  
  
Under the **Linear Mixed Effects Models**, we have build a model to describe the relationship between the number of promotion and average productivity, gender and team groups, and group by leadership appropriate of employees. From the \textit{Table ?}l, it illustrates that the number of promotion would decreased by 0.2943 point in average when the employee is female rather than male. In addition, the 95% confidence interval in women group does not contain zero, it represents the female group has a significant effect in this model, and it provide a strong evidence to reject the null hypothesis (everyone has the equal opportunity on promotions)

```{r,echo=FALSE, results='hide', fig.show='hide'}
model_promote_productivity<- lmer(num_promoted~
                          gender+team+leadership_appropriate+avg_productivity+(1|leadership_appropriate),
                           data=new_data)
summary(model_promote_productivity)
confint(model_promote_productivity)
```
\begin{table}
\centering
\caption{Model parameter from promotion productivity}
\begin{tabular}{|c|c|c|}
  \hline
  Parameter & Estimation & 95\%CI\\
  \hline
  Intercept &  0.6567  & [ 0.3205, 0.9903]\\
  \hline
  genderWomen & -0.3020  &[ -0.4340,-0.1684]\\
  \hline
  leadership\_appropriate & 0.1163 &[0.1036, 0.1285]\\
  \hline
  avg\_productivity & 0.0055 &[0.0004, 0.0104]\\
  \hline
\end{tabular}
\end{table}

Under this **liner mixed effect model**, it adds a new variable to show the effect on the average productivity to the opportunity to promoted. From the \textit{Table ?}, the women group also has a less number of promotion than the men, and the 95% confidence interval of women do not contain zero, which means gender has a significant impact on the number of promotion. This result is as same as the previous model. Moerover, the 95% confidence interval of average productivity effect does not include zero, it represents the changing of productivity provide a significance difference on number of employee's promotion.

```{r}
lrtest(model_num_promote,model_promote_productivity)
AIC(model_num_promote,model_promote_productivity)
BIC(model_num_promote,model_promote_productivity)
```
\begin{table}
\centering
\caption{Likelihood ratio test table}
\begin{tabular}{|c|c|c|c|c|c|c|}
  \hline
  Model & \#DF & AIC & BIC & LogLik & Chisq & Pr(>Chisq)\\
  \hline
  num\_promote & 13 & 1490.727 & 1548.038	 & -732.36 \\
  \hline
  promote\_productivity & 14 & 1498.344 & 1560.063 & -735.17 & 5.6169 & 0.0178\\
  \hline
\end{tabular}
\end{table}


By using the likelihood ratio test table \textit{Table ?}, we can find that the likelihood ratio Chi-Squared statistic and the p-value is smaller than 0.05, which is 0.0178, it represents the average productivity is an important effect when the employees have the chance to promote. However, from the AIC and BIC value, the model without productivity effect has a relatively smaller value, it represents this model perform better on fitting this data set. After combine the two model results, the female group perhaps has few number of promotion and less opportunity to promote than the male, though the there is not exist an obvious different about productivity in the male and female groups from the \textit{Figure ?}.


In conclusion, after analysis the linear mixed effect model with number of promotion, gender, team and leadership performance, the result shows that number of promotion would decreased by 0.2943 point in average when the employee is female rather than male, and this effect is significant in this model. From the four graphs above, the main idea is the males occupied a relative large percentage in all nine senior position, and female group has a relative smaller number to be promoted within a same level of productivity. Therefore, the gender perhaps affect the promotion process and result in Black Saber Software.

## Discussion

_In this section you will summarize your findings across all the research questions and discuss the strengths and limitations of your work. It doesn't have to be long, but keep in mind that often people will just skim the intro and the discussion of a document like this, so make sure it is useful as a semi-standalone section (doesn't have to be completely standalone like the executive summary)._

### Strengths and limitations

\newpage
# Consultant information
## Consultant profiles

**Gancheng Luo**. Gancheng is the CEO of White Shield Analytics. He founded this company and make it outstanding in the industry. He earned his Bachelor of Science, Majoring in Statistics, Minoring in Computer Science and Mathematics, from the University of Toronto in 2021.

**Ziqi Gao** Ziqi is a senior consultant with White Shield Analytics. She specializes in data analysis and visualization. She earned her Bachelor of Science, Majoring in Economics and Statistics from the University of Toronto in 2021.

**Zhaowei Huang**. Zhaowei is a senior consultant with White Shield Analytics. He specializes in data visualization. Zhaowei earned his Bachelor of Science, Majoring in Statistics and Economics, Minoring in Computer Science, from the University of Toronto in 2021. 

**Lingjing Zou**. Lingjing is a senior consultant with White Shield. She specializes in data analysis and visualization. She finished Bachelor of Science with studying statistics from University of Toronto in 2021. She focuses on creating organizational and reproducible solutions with analysis, documentation and communication.

## Code of ethical conduct  

The mission of White field is to provide solutions and analysis to our clients with high standards statistical services and support . We are committed to demonstrate the professional practices in any stage of our services with the obligation to work in a fair, respectful and ethical manner . The followings are the four major areas of responsibility that define ethical statistical practice in White Shield.  
  
### A. Responsibilities to Client  
- Strive to explain clearly the foreseeable adverse consequences and effects caused by the violation of the agreed sampling and analysis plan.  
- Display clients other statistical method options that differ in size, cost, and accuracy, but are also effective.  
  
### B. Responsibilities to Data and Methods Integrity  
- Present the limitations and the possible errors of statistical inference.  
- Report the data source and evaluate the appropriateness of the data  

### C. Responsibilities to Professional  
- Reduce the presumption and influence of the data provider's preference on the statistical analysis and results.  
- Respect other's contributions and intellectual property rights.  
  
### D. Responsibilities to Other Statistical Practitioners  
- Improve the quality of the work of others through peer review. When reviewing, respect different opinions, and do not target individuals, only evaluate methods. Strive to complete the review task comprehensively and carefully.  
- Instill in students and non-statisticians their understanding of the practical value of the statistical concepts and methods they are learning and applying.  
